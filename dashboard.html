<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SchoolFlow Hub - Dashboard</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%232575fc'/%3E%3Cpath d='M14 22h36v4H14zm0 10h36v4H14zm0 10h24v4H14z' fill='white'/%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://parseapi.back4app.com" crossorigin>

    <link id="css-dashboard" rel="stylesheet" href="dashboard.css">
    <script>
        (function(){
            var p = new URLSearchParams(location.search);
            var h = location.hostname;
            var isDev = p.has('dev') || h === 'localhost' || h === '127.0.0.1' || h.startsWith('192.168.') || h.endsWith('.local');
            var v = isDev ? Date.now() : '1';
            var link = document.getElementById('css-dashboard');
            if (link) {
                var base = (link.getAttribute('href') || 'dashboard.css').split('?')[0];
                link.setAttribute('href', base + '?v=' + v);
            }
            function loadDashboardScript(){
                if (document.getElementById('js-dashboard')) return;
                var s = document.createElement('script');
                s.id = 'js-dashboard';
                s.src = 'dashboard.js?v=' + v;
                s.defer = true;
                document.head.appendChild(s);
            }
            if (window.Parse) {
                loadDashboardScript();
            } else {
                var start = Date.now();
                var int = setInterval(function(){
                    if (window.Parse || Date.now() - start > 7000) {
                        clearInterval(int);
                        loadDashboardScript();
                    }
                }, 50);
                window.addEventListener('load', loadDashboardScript, { once: true });
            }
        })();
    </script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="dashboard">
        <aside class="sidebar" id="sidebar" role="navigation">
            <a href="#overview" class="active">Overview</a>
            <a href="#students">Students</a>
            <a href="#teachers">Teachers</a>
            <a href="#courses">Courses</a>
            <a href="#attendance">Attendance</a>
            <a href="#grades">Grades</a>
            <a href="#reports-analytics">Reports &amp; Analytics</a>
            <a href="#settings">Settings</a>
            <div class="sidebar-footer">
                <a href="loginPage.html" id="logoutBtn" class="logout-btn">Logout</a>
            </div>
        </aside>

        <main class="main-content">
            <header>
                <div class="header-content">
                    <h1>SchoolFlow-Hub</h1>
                    <button class="burger" type="button" aria-label="Toggle sidebar" aria-controls="sidebar" aria-expanded="false">&#9776;</button>
                </div>
            </header>

            <div id="overview" class="dashboard-content-section active">
                <h2>Dashboard Overview</h2>
                <div class="overview-grid">
                    <div class="chart-container card">
                        <canvas id="coursePopularityChart"></canvas>
                    </div>
                    <div class="chart-container card">
                        <canvas id="overallAttendanceChart"></canvas>
                    </div>
                    <div class="chart-container card">
                        <canvas id="topStudentsChart"></canvas>
                    </div>
                </div>
                <div class="quick-actions">
                    <a href="#students" class="button primary-button">Add Student</a>
                    <a href="#teachers" class="button primary-button">Add Teacher</a>
                    <a href="#courses" class="button primary-button">Add Course</a>
                    <a href="#attendance" class="button primary-button">Record Attendance</a>
                    <a href="#grades" class="button primary-button">Add Grade</a>
                    <button class="button secondary-button" onclick="refreshDashboard()">Refresh Dashboard</button>
                </div>
            </div>

            <div id="students" class="dashboard-content-section">
                <h2>Student Management</h2>
                <div class="card form-container">
                    <h3 id="student-form-heading">Add New Student</h3>
                    <form id="addStudentForm">
                    <label for="studentName">Student Name</label>
                    <input type="text" id="studentName" name="studentName" placeholder="Student Name" required>
                    
                    <label for="studentID">National ID</label>
                    <input type="text" id="studentID" name="studentID" placeholder="National ID" required>
                    
                    <label for="studentCourse">Course</label>
                    <input type="text" id="studentCourse" name="studentCourse" placeholder="Course">
                    
                    <label for="studentSeason">Season</label>
                    <input type="number" id="studentSeason" name="studentSeason" placeholder="Season">
                    
                    <label for="studentPhone">Phone Number</label>
                    <input type="tel" id="studentPhone" name="studentPhone" placeholder="Phone Number">
                    
                    <label for="studentLocation">Place of Living</label>
                    <input type="text" id="studentLocation" name="studentLocation" placeholder="Place of Living">
                    
                    <button type="submit" class="button primary-button" id="saveStudentBtn">Save Student</button>
                    <button type="button" class="button cancel-button" id="cancelStudentBtn" style="display: none;">Cancel</button>
                    </form>
                    <div class="bulk-upload-section">
                        <h3>Bulk Upload Students</h3>
                        <form id="bulkUploadForm">
                            <label for="bulkUploadFile">Bulk Upload File (.csv or .json)</label>
                            <input type="file" id="bulkUploadFile" name="bulkUploadFile" accept=".csv, .json" required>
                            <button type="submit" class="button secondary-button">Upload File</button>
                        </form>
                        <div id="uploadStatus"></div>
                    </div>
                </div>
                <div class="card table-container">
                    <h3>Student List</h3>
                    <table id="studentTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Course</th>
                                <th>ID</th>
                                <th>Season</th>
                                <th>Phone</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="teachers" class="dashboard-content-section">
                <h2>Teacher Management</h2>
                <div class="card form-container">
                    <h3 id="teacher-form-heading">Add New Teacher</h3>
                    <form id="addTeacherForm">
                        <label for="teacherName">Teacher Name</label>
                        <input type="text" id="teacherName" name="teacherName" placeholder="Teacher Name" required>
                        
                        <label for="teacherEmail">Email</label>
                        <input type="email" id="teacherEmail" name="teacherEmail" placeholder="Email" required>
                        
                        <label for="teacherPhone">Phone Number</label>
                        <input type="tel" id="teacherPhone" name="teacherPhone" placeholder="Phone Number">
                        
                        <button type="submit" class="button primary-button" id="saveTeacherBtn">Save Teacher</button>
                        <button type="button" class="button cancel-button" id="cancelTeacherBtn" style="display: none;">Cancel</button>
                    </form>
                </div>
                <div class="card table-container">
                    <h3>Teachers List</h3>
                    <table id="teacherTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div id="courses" class="dashboard-content-section">
                <h2>Course Management</h2>
                <div class="card form-container">
                    <h3 id="course-form-heading">Add New Course</h3>
                    <form id="addCourseForm">
                        <label for="courseName">Course Name</label>
                        <input type="text" id="courseName" name="courseName" placeholder="Course Name" required>
                        
                        <label for="courseDescription">Course Description</label>
                        <textarea id="courseDescription" name="courseDescription" placeholder="Course Description" required></textarea>
                        
                        <label for="assignedTeacher">Assigned Teacher</label>
                        <select id="assignedTeacher" name="assignedTeacher" required>
                            <option value="">-- Select Teacher --</option>
                        </select>
                        <button type="submit" class="button primary-button" id="saveCourseBtn">Save Course</button>
                        <button type="button" class="button cancel-button" id="cancelCourseBtn" style="display: none;">Cancel</button>
                    </form>
                </div>
                <div class="card table-container">
                    <h3>Course List</h3>
                    <table id="courseTable">
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Description</th>
                                <th>Assigned Teacher</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="attendance" class="dashboard-content-section">
                <h2>Attendance</h2>
                <div class="card form-container">
                    <h3>Record Attendance</h3>
                    <form id="addAttendanceForm">
                        <label for="attendanceStudent">Student</label>
                        <select id="attendanceStudent" name="attendanceStudent" required>
                            <option value="">-- Select a Student --</option>
                        </select>
                        
                        <label for="attendanceDate">Date</label>
                        <input type="date" id="attendanceDate" name="attendanceDate" required>
                        
                        <label for="attendanceStatus">Status</label>
                        <select id="attendanceStatus" name="attendanceStatus" required>
                            <option value="Present">Present</option>
                            <option value="Absent">Absent</option>
                        </select>
                        <button type="submit" class="button primary-button">Record Attendance</button>
                    </form>
                </div>
                <div class="card table-container">
                    <h3>Attendance Records</h3>
                    <table id="attendanceTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Student</th>
                                <th>Course</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="grades" class="dashboard-content-section">
                <h2>Grades</h2>
                <div class="card form-container">
                    <h3>Add Grade</h3>
                    <form id="addGradeForm">
                        <label for="addGradeStudent">Student</label>
                        <select id="addGradeStudent" name="addGradeStudent" required>
                            <option value="">-- Select a Student --</option>
                        </select>
                        
                        <label for="assignmentName">Assignment Name</label>
                        <input type="text" id="assignmentName" name="assignmentName" placeholder="Assignment Name" required>
                        
                        <label for="assignmentScore">Score</label>
                        <input type="number" id="assignmentScore" name="assignmentScore" placeholder="Score" required>
                        
                        <label for="assignmentTotalScore">Total Score</label>
                        <input type="number" id="assignmentTotalScore" name="assignmentTotalScore" placeholder="Total Score" required>
                        
                        <label for="assignmentDate">Date</label>
                        <input type="date" id="assignmentDate" name="assignmentDate" required>
                        <button type="submit" class="button primary-button">Save Grade</button>
                    </form>
                </div>
                <div class="card table-container">
                    <h3>Grade List</h3>
                    <table id="gradesTable">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Assignment</th>
                                <th>Score</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

        <div id="reports-analytics" class="dashboard-content-section">
                <h2>Reports &amp; Analytics</h2>
                <div class="quick-actions">
                    <button class="button primary-button" onclick="refreshDashboard()">Refresh Data</button>
                    <button class="button secondary-button" onclick="exportStudentsCSV()">Export Students CSV</button>
                    <button class="button secondary-button" onclick="exportGradesCSV()">Export Grades CSV</button>
                    <button class="button secondary-button" onclick="exportAttendanceCSV()">Export Attendance CSV</button>
                    <button class="button secondary-button" onclick="downloadChart('lowPerformingAssignmentsChart','low-performing-assignments.png')">Download Chart</button>
                    <button class="button secondary-button" onclick="exportSummaryJSON()">Export Summary JSON</button>
                </div>
                <div class="reports-grid">
                    <div class="report-card chart-card">
                        <h3>Low Performing Assignments</h3>
                        <canvas id="lowPerformingAssignmentsChart"></canvas>
                    </div>
                    <div class="report-card">
                        <h3>Summary</h3>
                        <div class="report-content">
                            <p>Key metrics based on current data:</p>
                            <ul>
                                <li>Total students: <span id="summaryTotalStudents"></span></li>
                                <li>Total courses: <span id="summaryTotalCourses"></span></li>
                                <li>Total teachers: <span id="summaryTotalTeachers"></span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="settings" class="dashboard-content-section">
                <h2>Settings</h2>
                <div class="settings-grid">
                    <div class="setting-card">
                        <h3>Appearance</h3>
                        <div class="setting-content">
                            <label class="switch">
                                Dark Mode
                                <input type="checkbox" id="settingsDarkModeToggle">
                                <span class="slider"></span>
                            </label>
                            <p>Toggle dark theme for the dashboard interface.</p>
                            <button class="button secondary-button" onclick="resetPreferences()">Reset Preferences</button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <div id="appMessage" class="app-message" role="status" aria-live="polite" aria-atomic="true"></div>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <script type="text/javascript" src="https://unpkg.com/parse/dist/parse.min.js"></script>

</body>
</html>