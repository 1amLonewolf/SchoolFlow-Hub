<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SchoolFlow Hub - Dashboard</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://unpkg.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; connect-src 'self' https://parseapi.back4app.com; style-src 'self' https://cdnjs.cloudflare.com https://fonts.googleapis.com 'unsafe-inline'; img-src 'self' data:; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com data:; object-src 'none'; base-uri 'none';">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <link rel="icon" type="image/jpeg" href="SchoolFlow-Hub.png?v=2">
    <link rel="apple-touch-icon" href="SchoolFlow-Hub.png?v=2">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://parseapi.back4app.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link id="css-dashboard" rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-5e2ESR8Ycmos6g3gAKr1Jvwye8sW4U1u/cAKulfVJnkakCcMqhOudbtPnvJ+nbv7" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" integrity="sha384-9nhczxUqK87bcKHh20fSQcTGD4qq5GhayNYSYWqwBkINBhOfQLg/P5HG5lF1urn4" crossorigin="anonymous" defer></script>
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar" id="sidebar" role="navigation">
            <div class="sidebar-brand">
                <img src="SchoolFlow-Hub.png?v=2" alt="SchoolFlow Hub logo" class="sidebar-logo" width="96" height="96">
            </div>
            <a href="#overview" class="active">Overview</a>
            <a href="#students">Students</a>
            <a href="#teachers">Teachers</a>
            <a href="#courses">Courses</a>
            <a href="#attendance">Attendance</a>
            <a href="#exams">Exams</a>
            <a href="#seasons">Seasons</a>
            <a href="#graduation">Graduation</a>
            <a href="#reports-analytics">Reports & Analytics</a>
            <a href="#settings">Settings</a>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="logout-btn">Logout</button>
            </div>
        </aside>

        <main class="main-content">
            <header>
                <div class="header-content">
                    <h1>SchoolFlow-Hub</h1>
                    <div id="adminWelcome" class="admin-welcome">
                        <span id="welcomeMessage">Welcome, Admin</span>
                    </div>
                    <button class="burger" type="button" aria-label="Toggle sidebar" aria-controls="sidebar" aria-expanded="false">&#9776;</button>
                </div>
            </header>

            <div id="overview" class="dashboard-content-section active">
                <h2>Dashboard Overview - Season <span id="currentSeasonDisplay"></span></h2>
                <div class="overview-grid">
                    <div class="chart-container card">
                        <canvas id="coursePopularityChart"></canvas>
                    </div>
                    <div class="chart-container card">
                        <canvas id="overallAttendanceChart"></canvas>
                    </div>
                    <div class="chart-container card">
                        <canvas id="topStudentsChart"></canvas>
                    </div>
                </div>
                <div class="quick-actions">
                    <a href="#students" class="button primary-button">Add Student</a>
                    <a href="#teachers" class="button primary-button">Add Teacher</a>
                    <a href="#courses" class="button primary-button">Add Course</a>
                    <a href="#attendance" class="button primary-button">Record Attendance</a>
                    <button class="button secondary-button" id="refreshDashboardBtn">Refresh Dashboard</button>
                </div>
            </div>

            <div id="students" class="dashboard-content-section">
                <h2>Student Management</h2>
                <div class="card form-container">
                    <h3 id="student-form-heading">Add New Student</h3>
                    <form id="addStudentForm">
                        <div class="form-field">
                            <label for="studentName">Student Name</label>
                            <input type="text" id="studentName" name="studentName" placeholder="Student Name" required autocomplete="name">
                        </div>
                        <div class="form-field">
                            <label for="studentID">National ID</label>
                            <input type="text" id="studentID" name="studentID" placeholder="National ID" required autocomplete="off">
                        </div>
                        <div class="form-field">
                            <label for="studentCourse">Course</label>
                            <input type="text" id="studentCourse" name="studentCourse" placeholder="Course" autocomplete="off">
                        </div>
                        <div class="form-field">
                            <label for="studentSeason">Season</label>
                            <input type="number" id="studentSeason" name="studentSeason" placeholder="Season" autocomplete="off">
                        </div>
                        <div class="form-field">
                            <label for="studentPhone">Phone Number</label>
                            <input type="tel" id="studentPhone" name="studentPhone" placeholder="Phone Number" autocomplete="tel">
                        </div>
                        <div class="form-field">
                            <label for="studentLocation">Place of Living</label>
                            <input type="text" id="studentLocation" name="studentLocation" placeholder="Place of Living" autocomplete="street-address">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="button primary-button" id="saveStudentBtn">Save Student</button>
                            <button type="button" class="button cancel-button" id="cancelStudentBtn">Cancel</button>
                        </div>
                    </form>
                    <div class="bulk-upload-section">
                        <h3>Bulk Upload Students</h3>
                        <form id="bulkUploadForm">
                            <label for="bulkUploadFile">Bulk Upload File (.csv or .json)</label>
                            <input type="file" id="bulkUploadFile" name="bulkUploadFile" accept=".csv, .json" required>
                            <button type="submit" class="button secondary-button">Upload File</button>
                        </form>
                        <div id="uploadStatus"></div>
                    </div>
                </div>
                <div class="card table-container">
                    <h3>Student List</h3>
                    <table id="studentTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Course</th>
                                <th>ID</th>
                                <th>Season</th>
                                <th>Phone</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="teachers" class="dashboard-content-section">
                <h2>Teacher Management</h2>
                <div class="card form-container">
                    <h3 id="teacher-form-heading">Add New Teacher</h3>
                    <form id="addTeacherForm">
                        <div class="form-field">
                            <label for="teacherName">Teacher Name</label>
                            <input type="text" id="teacherName" name="teacherName" placeholder="Teacher Name" required autocomplete="name">
                        </div>
                        <div class="form-field">
                            <label for="teacherEmail">Email</label>
                            <input type="email" id="teacherEmail" name="teacherEmail" placeholder="Email" required autocomplete="email">
                        </div>
                        <div class="form-field">
                            <label for="teacherPhone">Phone Number</label>
                            <input type="tel" id="teacherPhone" name="teacherPhone" placeholder="Phone Number" autocomplete="tel">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="button primary-button" id="saveTeacherBtn">Save Teacher</button>
                            <button type="button" class="button cancel-button" id="cancelTeacherBtn">Cancel</button>
                        </div>
                    </form>
                </div>
                <div class="card table-container">
                    <h3>Teachers List</h3>
                    <table id="teacherTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <div id="courses" class="dashboard-content-section">
                <h2>Course Management</h2>
                <div class="card form-container">
                    <h3 id="course-form-heading">Add New Course</h3>
                    <form id="addCourseForm">
                        <div class="form-field">
                            <label for="courseName">Course Name</label>
                            <input type="text" id="courseName" name="courseName" placeholder="Course Name" required autocomplete="off">
                        </div>
                        <div class="form-field">
                            <label for="courseDescription">Course Description</label>
                            <textarea id="courseDescription" name="courseDescription" placeholder="Course Description" required autocomplete="off"></textarea>
                        </div>
                        <div class="form-field">
                            <label for="assignedTeacher">Assigned Teacher</label>
                            <select id="assignedTeacher" name="assignedTeacher" required autocomplete="off">
                                <option value="">-- Select Teacher --</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="button primary-button" id="saveCourseBtn">Save Course</button>
                            <button type="button" class="button cancel-button" id="cancelCourseBtn">Cancel</button>
                        </div>
                    </form>
                </div>
                <div class="card table-container">
                    <h3>Course List</h3>
                    <table id="courseTable">
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Description</th>
                                <th>Assigned Teacher</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="attendance" class="dashboard-content-section">
                <h2>Attendance</h2>
                <div class="card form-container">
                    <h3>Record Attendance</h3>
                    <form id="addAttendanceForm">
                        <div class="form-field">
                            <label for="attendanceStudent">Student</label>
                            <select id="attendanceStudent" name="attendanceStudent" required>
                                <option value="">-- Select a Student --</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="attendanceDate">Date</label>
                            <input type="date" id="attendanceDate" name="attendanceDate" required autocomplete="off">
                        </div>
                        <div class="form-field">
                            <label for="attendanceStatus">Status</label>
                            <select id="attendanceStatus" name="attendanceStatus" required autocomplete="off">
                                <option value="Present">Present</option>
                                <option value="Absent">Absent</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="button primary-button">Record Attendance</button>
                        </div>
                    </form>
                </div>
                <div class="card table-container">
                    <h3>Attendance Records</h3>
                    <table id="attendanceTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Student</th>
                                <th>Course</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="reports-analytics" class="dashboard-content-section">
                <h2>Reports & Analytics</h2>
                <div class="quick-actions">
                    <button class="button primary-button" id="refreshDashboardReportsBtn">Refresh Data</button>
                    <button class="button secondary-button" id="exportStudentsCsvBtn">Export Students CSV</button>
                    <button class="button secondary-button" id="exportAttendanceCsvBtn">Export Attendance CSV</button>
                    <button class="button secondary-button" id="downloadLowAssignmentsBtn">Download Chart</button>
                    <button class="button secondary-button" id="exportSummaryJsonBtn">Export Summary JSON</button>
                </div>
                <div class="reports-grid">
                    <div class="report-card chart-card">
                        <h3>Low Performing Assignments</h3>
                        <canvas id="lowPerformingAssignmentsChart"></canvas>
                    </div>
                    <div class="report-card">
                        <h3>Summary</h3>
                        <div class="report-content">
                            <p>Key metrics based on current data:</p>
                            <ul>
                                <li>Total students: <span id="summaryTotalStudents"></span></li>
                                <li>Total courses: <span id="summaryTotalCourses"></span></li>
                                <li>Total teachers: <span id="summaryTotalTeachers"></span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="exams" class="dashboard-content-section">
                <h2>Exam Records</h2>
                <div class="card form-container">
                    <h3 id="exam-form-heading">Add New Exam Record</h3>
                    <form id="addExamForm">
                        <div class="form-field">
                            <label for="examStudent">Student</label>
                            <select id="examStudent" name="examStudent" required>
                                <option value="">-- Select a Student --</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="examType">Exam Type</label>
                            <select id="examType" name="examType" required>
                                <option value="">-- Select Exam Type --</option>
                                <option value="Midterm">Midterm</option>
                                <option value="Endterm">Endterm</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="examCategory">Exam Category</label>
                            <select id="examCategory" name="examCategory" required>
                                <option value="">-- Select Category --</option>
                                <option value="Chapel">Chapel</option>
                                <option value="Course">Course</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="examCourse">Course</label>
                            <select id="examCourse" name="examCourse" required>
                                <option value="">-- Select a Course --</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label for="examScore">Score</label>
                            <input type="number" id="examScore" name="examScore" placeholder="Score" min="0" required>
                        </div>
                        <div class="form-field">
                            <label for="examTotalScore">Total Score</label>
                            <input type="number" id="examTotalScore" name="examTotalScore" placeholder="Total Score" min="1" required>
                        </div>
                        <div class="form-field">
                            <label for="examDate">Date</label>
                            <input type="date" id="examDate" name="examDate" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="button primary-button" id="saveExamBtn">Save Exam Record</button>
                            <button type="button" class="button cancel-button" id="cancelExamBtn">Cancel</button>
                        </div>
                    </form>
                </div>
                <div class="card table-container">
                    <h3>Exam Records</h3>
                    <!-- Exam Records Controls -->
                    <div class="exam-controls" style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                        <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
                            <div>
                                <label for="examSearch" style="font-weight: 500; margin-right: 10px;">Search:</label>
                                <input type="text" id="examSearch" placeholder="Search exams..." style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px;">
                            </div>
                            <div>
                                <label for="examCourseFilter" style="font-weight: 500; margin-right: 10px;">Course:</label>
                                <select id="examCourseFilter" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="">All Courses</option>
                                </select>
                            </div>
                            <div>
                                <label for="examTypeFilter" style="font-weight: 500; margin-right: 10px;">Exam Type:</label>
                                <select id="examTypeFilter" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="">All Types</option>
                                    <option value="Midterm">Midterm</option>
                                    <option value="Endterm">Endterm</option>
                                </select>
                            </div>
                            <div>
                                <label for="examDateSort" style="font-weight: 500; margin-right: 10px;">Sort By:</label>
                                <select id="examDateSort" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="newest">Newest First</option>
                                    <option value="oldest">Oldest First</option>
                                    <option value="highest">Highest Score</option>
                                    <option value="lowest">Lowest Score</option>
                                </select>
                            </div>
                            <div>
                                <button id="clearExamFilters" class="button secondary-button" style="padding: 8px 15px;">Clear Filters</button>
                            </div>
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <span id="examRecordCount" style="font-weight: 500;">Total Records: <span id="examTotalCount">0</span></span>
                            <span id="filteredRecordCount" style="font-weight: 500; color: #2575fc;">Filtered: <span id="examFilteredCount">0</span></span>
                        </div>
                    </div>
                    <!-- End Exam Records Controls -->
                    <table id="examTable">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Exam Type</th>
                                <th>Category</th>
                                <th>Course</th>
                                <th>Score</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <!-- Pagination Controls -->
                    <div id="examPagination" class="pagination-controls" style="margin-top: 20px; display: flex; justify-content: center; align-items: center; gap: 10px;">
                        <button id="examPrevPage" class="button secondary-button" disabled>Previous</button>
                        <span id="examPageInfo">Page 1 of 1</span>
                        <button id="examNextPage" class="button secondary-button" disabled>Next</button>
                        <select id="examPageSize" style="padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
                            <option value="10">10 per page</option>
                            <option value="25" selected>25 per page</option>
                            <option value="50">50 per page</option>
                            <option value="100">100 per page</option>
                        </select>
                    </div>
                    <!-- End Pagination Controls -->
                </div>
            </div>

            <div id="graduation" class="dashboard-content-section">
                <h2>Graduation Eligibility</h2>
                <div class="card">
                    <h3>Check Eligibility</h3>
                    <p>Verify which students meet the requirements for graduation based on attendance and exam completion.</p>
                    <button id="checkGraduationBtn" class="button primary-button">Check Eligibility Now</button>
                </div>
                <div id="graduationResults" class="card">
                    <h3>Results</h3>
                    <div id="graduationStats"></div>
                    <h4>Eligible Students</h4>
                    <div class="download-section" style="margin: 15px 0;">
                        <button id="downloadGraduationList" class="button secondary-button">Download Eligible Students List</button>
                    </div>
                    <div class="table-container" id="eligibleStudentsContainer">
                        <table id="eligibleStudentsTable">
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Course</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="settings" class="dashboard-content-section">
                <h2>Settings</h2>
                <div class="settings-grid">
                    <div class="setting-card">
                        <h3>Appearance</h3>
                        <div class="setting-content">
                            <label class="switch">
                                Dark Mode
                                <input type="checkbox" id="settingsDarkModeToggle">
                                <span class="slider"></span>
                            </label>
                            <p>Toggle dark theme for the dashboard interface.</p>
                            <button class="button secondary-button" id="resetPreferencesBtn">Reset Preferences</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="seasons" class="dashboard-content-section">
                <h2>Season Management</h2>
                <div class="card">
                    <h3>Current Season</h3>
                    <div class="season-info">
                        <p>Current Season: <strong>Season <span id="currentSeasonNumber">1</span></strong></p>
                        <p>Total Students: <strong><span id="currentSeasonStudentCount">0</span></strong></p>
                        <p>Total Courses: <strong><span id="currentSeasonCourseCount">0</span></strong></p>
                    </div>
                    <div class="season-actions">
                        <button class="button primary-button" id="advanceSeasonBtn">Advance to Next Season</button>
                        <button class="button secondary-button" id="archiveCurrentSeasonBtn">Archive Current Season</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Season History</h3>
                    <div class="table-container">
                        <table id="seasonsTable">
                            <thead>
                                <tr>
                                    <th>Season</th>
                                    <th>Students</th>
                                    <th>Courses</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Season data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Season Reports</h3>
                    <div class="season-reports">
                        <button class="button secondary-button" id="exportCurrentSeasonBtn">Export Current Season Data</button>
                        <button class="button secondary-button" id="exportAllSeasonsBtn">Export All Seasons Summary</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="appMessage" class="app-message" role="status" aria-live="polite" aria-atomic="true"></div>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <script type="text/javascript" src="https://unpkg.com/parse@3.5.0/dist/parse.min.js" integrity="sha384-Mz2IuwzErOmLZO5CL/dA/e9J6/CPmJj85krQJUq7sGQqyKh/tUegVCix9rHZNKeh" crossorigin="anonymous"></script>
    <script src="dashboard.js?v=1" defer></script>
</body>
</html>